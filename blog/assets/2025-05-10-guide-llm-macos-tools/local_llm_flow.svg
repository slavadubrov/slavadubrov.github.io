<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450">
  <defs>
    <style>
      .box { fill: #ffffff; stroke: #333; stroke-width: 2; rx: 8; ry: 8; }
      .highlight { fill: #e6f7ff; stroke: #1890ff; stroke-width: 2; rx: 8; ry: 8; }
      .hardware { fill: #f6ffed; stroke: #52c41a; stroke-width: 2; rx: 8; ry: 8; }
      .text { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 14px; text-anchor: middle; fill: #333; }
      .label { font-size: 12px; fill: #666; }
      .arrow { stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); fill: none; }
      .dashed { stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <rect width="800" height="450" fill="#fcfcfc" rx="10" ry="10" />
  <text x="400" y="30" class="text" font-size="18" font-weight="bold">Local LLM Architecture on macOS</text>

  <!-- Layer 1: User Space -->
  <rect x="50" y="80" width="150" height="300" fill="#f0f0f0" rx="10" ry="10" stroke="none"/>
  <text x="125" y="70" class="text" font-weight="bold">User Space</text>

  <rect x="75" y="120" width="100" height="60" class="box" />
  <text x="125" y="145" class="text">User Prompt</text>
  <text x="125" y="165" class="text label">"Why is sky blue?"</text>

  <rect x="75" y="280" width="100" height="60" class="box" />
  <text x="125" y="305" class="text">Response</text>
  <text x="125" y="325" class="text label">"Rayleigh scattering..."</text>

  <!-- Layer 2: Application Layer -->
  <rect x="250" y="150" width="160" height="160" class="highlight" />
  <text x="330" y="140" class="text" font-weight="bold">Application</text>
  <text x="330" y="180" class="text">Ollama / LM Studio</text>
  <text x="330" y="200" class="text label">(Orchestration)</text>
  <line x1="260" y1="210" x2="400" y2="210" stroke="#1890ff" stroke-width="1" />
  <text x="330" y="235" class="text">Inference Engine</text>
  <text x="330" y="255" class="text label">(llama.cpp / MLX)</text>

  <!-- Layer 3: System Resources -->
  <rect x="480" y="80" width="270" height="300" fill="#f9f9f9" rx="10" ry="10" stroke="#ddd" stroke-dasharray="4"/>
  <text x="615" y="70" class="text" font-weight="bold">System Resources</text>

  <!-- Model Weights -->
  <rect x="535" y="100" width="160" height="60" class="box" />
  <text x="615" y="125" class="text">Model Weights</text>
  <text x="615" y="145" class="text label">.gguf file (Disk)</text>

  <!-- Unified Memory -->
  <rect x="510" y="200" width="210" height="150" class="hardware" />
  <text x="615" y="225" class="text" font-weight="bold">Apple Silicon</text>

  <rect x="535" y="240" width="160" height="40" fill="#fff" stroke="#52c41a" rx="4" />
  <text x="615" y="265" class="text">Unified Memory (RAM)</text>

  <rect x="535" y="295" width="70" height="40" fill="#fff" stroke="#52c41a" rx="4" />
  <text x="570" y="320" class="text">CPU</text>

  <rect x="625" y="295" width="70" height="40" fill="#fff" stroke="#52c41a" rx="4" />
  <text x="660" y="320" class="text">GPU</text>

  <!-- Arrows -->
  <!-- Prompt to App -->
  <path d="M 175 150 L 250 180" class="arrow" />

  <!-- App to Response -->
  <path d="M 250 280 L 175 310" class="arrow" />

  <!-- App to Memory (Loading) -->
  <path d="M 410 230 L 510 260" class="arrow" />
  <text x="460" y="240" class="label">Load Model</text>

  <!-- Weights to Memory -->
  <path d="M 615 160 L 615 200" class="arrow" />
  <text x="620" y="185" class="label" text-anchor="start">Load</text>

  <!-- Compute Loop -->
  <path d="M 535 315 Q 500 315 500 280 Q 500 245 535 245" class="arrow" fill="none" stroke="#52c41a" />
  <text x="495" y="285" class="label" transform="rotate(-90, 495, 285)">Compute</text>

</svg>
