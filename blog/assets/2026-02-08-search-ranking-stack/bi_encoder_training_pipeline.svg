<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 820 480" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrowTrn" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <filter id="shadowTrn" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="410" y="28" text-anchor="middle" font-size="18" font-weight="700" fill="#1a1a2e">Bi-Encoder Training Pipeline</text>
  <text x="410" y="48" text-anchor="middle" font-size="12" fill="#666">Contrastive learning with hard negatives (InfoNCE loss)</text>

  <!-- Training Triplet -->
  <rect x="30" y="70" width="160" height="36" rx="6" fill="#e3f2fd" stroke="#1565c0" stroke-width="1.2" filter="url(#shadowTrn)"/>
  <text x="110" y="93" text-anchor="middle" font-size="12" font-weight="600" fill="#1565c0">Query</text>

  <rect x="330" y="70" width="160" height="36" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.2" filter="url(#shadowTrn)"/>
  <text x="410" y="93" text-anchor="middle" font-size="12" font-weight="600" fill="#2e7d32">Positive Doc (d+)</text>

  <rect x="630" y="70" width="160" height="36" rx="6" fill="#ffebee" stroke="#c62828" stroke-width="1.2" filter="url(#shadowTrn)"/>
  <text x="710" y="93" text-anchor="middle" font-size="12" font-weight="600" fill="#c62828">Hard Negative (d-)</text>

  <!-- Arrows down to encoder -->
  <line x1="110" y1="106" x2="110" y2="148" stroke="#555" stroke-width="1.2" marker-end="url(#arrowTrn)"/>
  <line x1="410" y1="106" x2="410" y2="148" stroke="#555" stroke-width="1.2" marker-end="url(#arrowTrn)"/>
  <line x1="710" y1="106" x2="710" y2="148" stroke="#555" stroke-width="1.2" marker-end="url(#arrowTrn)"/>

  <!-- Shared Encoder (spans across all three) -->
  <rect x="50" y="150" width="720" height="50" rx="8" fill="#bbdefb" stroke="#1565c0" stroke-width="1.5" filter="url(#shadowTrn)"/>
  <text x="410" y="172" text-anchor="middle" font-size="14" font-weight="700" fill="#0d47a1">Shared Transformer Encoder</text>
  <text x="410" y="190" text-anchor="middle" font-size="10" fill="#1565c0">Same weights for all inputs (Siamese architecture)</text>

  <!-- Arrows down to embeddings -->
  <line x1="110" y1="200" x2="110" y2="238" stroke="#555" stroke-width="1.2" marker-end="url(#arrowTrn)"/>
  <line x1="410" y1="200" x2="410" y2="238" stroke="#555" stroke-width="1.2" marker-end="url(#arrowTrn)"/>
  <line x1="710" y1="200" x2="710" y2="238" stroke="#555" stroke-width="1.2" marker-end="url(#arrowTrn)"/>

  <!-- Embeddings -->
  <rect x="50" y="240" width="120" height="34" rx="6" fill="#e8eaf6" stroke="#3949ab" stroke-width="1" filter="url(#shadowTrn)"/>
  <text x="110" y="262" text-anchor="middle" font-size="11" font-weight="600" fill="#3949ab">q embedding</text>

  <rect x="350" y="240" width="120" height="34" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1" filter="url(#shadowTrn)"/>
  <text x="410" y="262" text-anchor="middle" font-size="11" font-weight="600" fill="#2e7d32">d+ embedding</text>

  <rect x="650" y="240" width="120" height="34" rx="6" fill="#ffebee" stroke="#c62828" stroke-width="1" filter="url(#shadowTrn)"/>
  <text x="710" y="262" text-anchor="middle" font-size="11" font-weight="600" fill="#c62828">d- embedding</text>

  <!-- Similarity computations -->
  <line x1="150" y1="274" x2="250" y2="320" stroke="#2e7d32" stroke-width="1.5" marker-end="url(#arrowTrn)"/>
  <line x1="380" y1="274" x2="280" y2="320" stroke="#2e7d32" stroke-width="1.5" marker-end="url(#arrowTrn)"/>

  <line x1="150" y1="274" x2="530" y2="320" stroke="#c62828" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowTrn)"/>
  <line x1="670" y1="274" x2="570" y2="320" stroke="#c62828" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowTrn)"/>

  <!-- Similarity boxes -->
  <rect x="205" y="320" width="120" height="36" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.2" filter="url(#shadowTrn)"/>
  <text x="265" y="338" text-anchor="middle" font-size="11" font-weight="600" fill="#2e7d32">sim(q, d+)</text>
  <text x="265" y="352" text-anchor="middle" font-size="9" fill="#2e7d32">Maximize</text>

  <rect x="490" y="320" width="120" height="36" rx="6" fill="#ffebee" stroke="#c62828" stroke-width="1.2" filter="url(#shadowTrn)"/>
  <text x="550" y="338" text-anchor="middle" font-size="11" font-weight="600" fill="#c62828">sim(q, d-)</text>
  <text x="550" y="352" text-anchor="middle" font-size="9" fill="#c62828">Minimize</text>

  <!-- Arrows down to loss -->
  <line x1="265" y1="356" x2="350" y2="396" stroke="#555" stroke-width="1.2" marker-end="url(#arrowTrn)"/>
  <line x1="550" y1="356" x2="465" y2="396" stroke="#555" stroke-width="1.2" marker-end="url(#arrowTrn)"/>

  <!-- Contrastive Loss -->
  <rect x="310" y="398" width="200" height="60" rx="8" fill="#fff3e0" stroke="#e65100" stroke-width="1.5" filter="url(#shadowTrn)"/>
  <text x="410" y="420" text-anchor="middle" font-size="13" font-weight="700" fill="#e65100">InfoNCE Loss</text>
  <text x="410" y="440" text-anchor="middle" font-size="10" fill="#bf360c">-log( exp(sim+/t) /</text>
  <text x="410" y="452" text-anchor="middle" font-size="10" fill="#bf360c">S exp(sim_i/t) )</text>

</svg>
