<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 520" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrowFunnel" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <filter id="shadowF" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="400" y="32" text-anchor="middle" font-size="18" font-weight="700" fill="#1a1a2e">The Multi-Stage Ranking Funnel</text>

  <!-- Corpus -->
  <rect x="200" y="55" width="400" height="52" rx="8" fill="#f5f5f5" stroke="#999" stroke-width="1.5" filter="url(#shadowF)"/>
  <text x="400" y="77" text-anchor="middle" font-size="13" font-weight="600" fill="#333">Full Corpus</text>
  <text x="400" y="95" text-anchor="middle" font-size="11" fill="#666">10&#x2079; - 10&#xB9;&#xB2; documents</text>

  <!-- Arrow -->
  <line x1="400" y1="107" x2="400" y2="130" stroke="#555" stroke-width="1.5" marker-end="url(#arrowFunnel)"/>

  <!-- Stage 1: Retrieval -->
  <rect x="160" y="133" width="480" height="75" rx="8" fill="#e3f2fd" stroke="#1565c0" stroke-width="1.5" filter="url(#shadowF)"/>
  <text x="180" y="155" font-size="11" font-weight="700" fill="#1565c0">STAGE 1: RETRIEVAL</text>
  <text x="180" y="172" font-size="12" font-weight="600" fill="#333">BM25 + Dense Bi-Encoder + Hybrid RRF Fusion</text>
  <text x="180" y="190" font-size="11" fill="#555">Goal: Maximum Recall | Latency: &lt; 50ms</text>
  <text x="590" y="172" text-anchor="end" font-size="20" font-weight="700" fill="#1565c0">10&#x2074;</text>
  <text x="590" y="190" text-anchor="end" font-size="10" fill="#1565c0">candidates</text>

  <!-- Arrow -->
  <line x1="400" y1="208" x2="400" y2="231" stroke="#555" stroke-width="1.5" marker-end="url(#arrowFunnel)"/>
  <text x="416" y="224" font-size="10" fill="#888">~100 candidates per query</text>

  <!-- Stage 2: Pre-Ranking -->
  <rect x="180" y="234" width="440" height="68" rx="8" fill="#fff3e0" stroke="#e65100" stroke-width="1.5" filter="url(#shadowF)"/>
  <text x="200" y="256" font-size="11" font-weight="700" fill="#e65100">STAGE 2: PRE-RANKING</text>
  <text x="200" y="273" font-size="12" font-weight="600" fill="#333">Two-Tower Models + Interaction Features</text>
  <text x="200" y="289" font-size="11" fill="#555">Goal: Efficient Filtering | Latency: &lt; 100ms</text>
  <text x="575" y="273" text-anchor="end" font-size="20" font-weight="700" fill="#e65100">10&#xB2;-10&#xB3;</text>
  <text x="575" y="289" text-anchor="end" font-size="10" fill="#e65100">candidates</text>

  <!-- Arrow -->
  <line x1="400" y1="302" x2="400" y2="325" stroke="#555" stroke-width="1.5" marker-end="url(#arrowFunnel)"/>
  <text x="416" y="318" font-size="10" fill="#888">~50 candidates per query</text>

  <!-- Stage 3: Full Ranking -->
  <rect x="200" y="328" width="400" height="68" rx="8" fill="#fce4ec" stroke="#c62828" stroke-width="1.5" filter="url(#shadowF)"/>
  <text x="220" y="350" font-size="11" font-weight="700" fill="#c62828">STAGE 3: FULL RANKING</text>
  <text x="220" y="367" font-size="12" font-weight="600" fill="#333">Cross-Encoders + LLM Rerankers</text>
  <text x="220" y="383" font-size="11" fill="#555">Goal: Max Precision | Latency: &lt; 500ms</text>
  <text x="560" y="367" text-anchor="end" font-size="20" font-weight="700" fill="#c62828">10&#xB9;</text>
  <text x="560" y="383" text-anchor="end" font-size="10" fill="#c62828">candidates</text>

  <!-- Arrow -->
  <line x1="400" y1="396" x2="400" y2="419" stroke="#555" stroke-width="1.5" marker-end="url(#arrowFunnel)"/>

  <!-- Stage 4: Blending -->
  <rect x="240" y="422" width="320" height="68" rx="8" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.5" filter="url(#shadowF)"/>
  <text x="260" y="444" font-size="11" font-weight="700" fill="#2e7d32">STAGE 4: BLENDING</text>
  <text x="260" y="461" font-size="12" font-weight="600" fill="#333">Diversity + Business Rules</text>
  <text x="260" y="477" font-size="11" fill="#555">Goal: User Experience | &lt; 20ms</text>

  <!-- Cost gradient label on right -->
  <text x="690" y="145" font-size="10" fill="#888" text-anchor="start">Low cost</text>
  <text x="690" y="160" font-size="10" fill="#888" text-anchor="start">High speed</text>
  <line x1="680" y1="140" x2="680" y2="385" stroke="#ccc" stroke-width="1" stroke-dasharray="4"/>
  <text x="690" y="380" font-size="10" fill="#888" text-anchor="start">High cost</text>
  <text x="690" y="395" font-size="10" fill="#888" text-anchor="start">High precision</text>
  <!-- Arrow for gradient -->
  <line x1="680" y1="165" x2="680" y2="370" stroke="#bbb" stroke-width="1.5" marker-end="url(#arrowFunnel)"/>

</svg>
