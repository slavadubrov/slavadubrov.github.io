<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 820 420" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrowSrv" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <filter id="shadowSrv" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="410" y="28" text-anchor="middle" font-size="18" font-weight="700" fill="#1a1a2e">Bi-Encoder Serving: Offline Indexing vs. Online Query</text>

  <!-- Divider -->
  <line x1="410" y1="50" x2="410" y2="400" stroke="#ccc" stroke-width="1.5" stroke-dasharray="8,4"/>
  <text x="200" y="65" text-anchor="middle" font-size="13" font-weight="700" fill="#1565c0">Offline (Index Time)</text>
  <text x="620" y="65" text-anchor="middle" font-size="13" font-weight="700" fill="#e65100">Online (Query Time)</text>

  <!-- === LEFT SIDE: Offline === -->

  <!-- Document Corpus -->
  <rect x="50" y="85" width="160" height="40" rx="6" fill="#fff3e0" stroke="#e65100" stroke-width="1.2" filter="url(#shadowSrv)"/>
  <text x="130" y="102" text-anchor="middle" font-size="12" font-weight="600" fill="#e65100">Document Corpus</text>
  <text x="130" y="118" text-anchor="middle" font-size="9" fill="#bf360c">N documents</text>

  <!-- Arrow -->
  <line x1="210" y1="105" x2="250" y2="105" stroke="#555" stroke-width="1.2" marker-end="url(#arrowSrv)"/>

  <!-- Encoder -->
  <rect x="255" y="85" width="120" height="40" rx="6" fill="#bbdefb" stroke="#1565c0" stroke-width="1.2" filter="url(#shadowSrv)"/>
  <text x="315" y="102" text-anchor="middle" font-size="11" font-weight="600" fill="#0d47a1">Bi-Encoder</text>
  <text x="315" y="118" text-anchor="middle" font-size="9" fill="#1565c0">batch encode</text>

  <!-- Arrow -->
  <line x1="200" y1="125" x2="200" y2="168" stroke="#555" stroke-width="1.2" marker-end="url(#arrowSrv)"/>

  <!-- Embeddings Store -->
  <rect x="60" y="170" width="280" height="50" rx="6" fill="#e8eaf6" stroke="#3949ab" stroke-width="1.2" filter="url(#shadowSrv)"/>
  <text x="200" y="192" text-anchor="middle" font-size="12" font-weight="600" fill="#3949ab">Document Embeddings</text>
  <text x="200" y="208" text-anchor="middle" font-size="10" fill="#5c6bc0">N x D matrix (e.g., 8500 x 384 = 13 MB)</text>

  <!-- Arrow -->
  <line x1="200" y1="220" x2="200" y2="263" stroke="#555" stroke-width="1.2" marker-end="url(#arrowSrv)"/>

  <!-- Vector Index -->
  <rect x="80" y="265" width="240" height="55" rx="8" fill="#e3f2fd" stroke="#1565c0" stroke-width="1.5" filter="url(#shadowSrv)"/>
  <text x="200" y="288" text-anchor="middle" font-size="13" font-weight="700" fill="#1565c0">Vector Index</text>
  <text x="200" y="305" text-anchor="middle" font-size="10" fill="#1565c0">HNSW / IVF / DiskANN</text>

  <!-- One-time label -->
  <rect x="120" y="340" width="160" height="28" rx="14" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1"/>
  <text x="200" y="359" text-anchor="middle" font-size="11" font-weight="600" fill="#2e7d32">Done once, stored on disk</text>

  <!-- === RIGHT SIDE: Online === -->

  <!-- User Query -->
  <rect x="480" y="85" width="140" height="40" rx="6" fill="#e3f2fd" stroke="#1565c0" stroke-width="1.2" filter="url(#shadowSrv)"/>
  <text x="550" y="102" text-anchor="middle" font-size="12" font-weight="600" fill="#1565c0">User Query</text>
  <text x="550" y="118" text-anchor="middle" font-size="9" fill="#1565c0">"wireless headphones"</text>

  <!-- Arrow -->
  <line x1="620" y1="105" x2="660" y2="105" stroke="#555" stroke-width="1.2" marker-end="url(#arrowSrv)"/>

  <!-- Encoder -->
  <rect x="665" y="85" width="120" height="40" rx="6" fill="#bbdefb" stroke="#1565c0" stroke-width="1.2" filter="url(#shadowSrv)"/>
  <text x="725" y="102" text-anchor="middle" font-size="11" font-weight="600" fill="#0d47a1">Bi-Encoder</text>
  <text x="725" y="118" text-anchor="middle" font-size="9" fill="#1565c0">single encode</text>

  <!-- Arrow down -->
  <line x1="620" y1="125" x2="620" y2="168" stroke="#555" stroke-width="1.2" marker-end="url(#arrowSrv)"/>

  <!-- Query Embedding -->
  <rect x="530" y="170" width="180" height="40" rx="6" fill="#e8eaf6" stroke="#3949ab" stroke-width="1.2" filter="url(#shadowSrv)"/>
  <text x="620" y="192" text-anchor="middle" font-size="12" font-weight="600" fill="#3949ab">Query Embedding</text>
  <text x="620" y="206" text-anchor="middle" font-size="9" fill="#5c6bc0">1 x D vector</text>

  <!-- Timing label for encode -->
  <rect x="700" y="152" width="70" height="20" rx="10" fill="#fff3e0" stroke="#e65100" stroke-width="1"/>
  <text x="735" y="166" text-anchor="middle" font-size="9" font-weight="600" fill="#e65100">~5 ms</text>

  <!-- Arrow down -->
  <line x1="620" y1="210" x2="620" y2="263" stroke="#555" stroke-width="1.2" marker-end="url(#arrowSrv)"/>

  <!-- ANN Search -->
  <rect x="500" y="265" width="240" height="55" rx="8" fill="#fff3e0" stroke="#e65100" stroke-width="1.5" filter="url(#shadowSrv)"/>
  <text x="620" y="288" text-anchor="middle" font-size="13" font-weight="700" fill="#e65100">ANN Search</text>
  <text x="620" y="305" text-anchor="middle" font-size="10" fill="#bf360c">Query embedding vs. vector index</text>

  <!-- Timing label for ANN -->
  <rect x="700" y="245" width="70" height="20" rx="10" fill="#fff3e0" stroke="#e65100" stroke-width="1"/>
  <text x="735" y="259" text-anchor="middle" font-size="9" font-weight="600" fill="#e65100">~10 ms</text>

  <!-- Cross-connection: Vector Index â†’ ANN Search -->
  <path d="M320,292 Q380,292 410,292 Q440,292 500,292" stroke="#555" stroke-width="1.2" fill="none" stroke-dasharray="5,3" marker-end="url(#arrowSrv)"/>

  <!-- Arrow down to results -->
  <line x1="620" y1="320" x2="620" y2="358" stroke="#555" stroke-width="1.2" marker-end="url(#arrowSrv)"/>

  <!-- Top-K Results -->
  <rect x="510" y="360" width="220" height="40" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.2" filter="url(#shadowSrv)"/>
  <text x="620" y="378" text-anchor="middle" font-size="12" font-weight="700" fill="#2e7d32">Top-K Candidates</text>
  <text x="620" y="393" text-anchor="middle" font-size="10" fill="#2e7d32">Ranked by cosine similarity</text>

  <!-- Total timing -->
  <rect x="700" y="340" width="90" height="20" rx="10" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1"/>
  <text x="745" y="354" text-anchor="middle" font-size="9" font-weight="600" fill="#2e7d32">Total ~15 ms</text>

</svg>
