<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 530" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrowD" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <filter id="shadowD" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="250" y="22" text-anchor="middle" font-size="18" font-weight="700" fill="#1a1a2e">Demo Pipeline: search-ranking-stack</text>
  <text x="250" y="40" text-anchor="middle" font-size="12" fill="#666">Amazon ESCI benchmark -- ~500 queries, ~8.5K products</text>

  <!-- Stage 1: Retrieval -->
  <rect x="30" y="52" width="440" height="210" rx="10" fill="#f5f8ff" stroke="#1565c0" stroke-width="1" stroke-dasharray="4"/>
  <text x="45" y="72" font-size="12" font-weight="700" fill="#1565c0">Stage 1: Retrieval</text>

  <!-- Query -->
  <rect x="200" y="82" width="100" height="28" rx="14" fill="#f3e5f5" stroke="#6a1b9a" stroke-width="1.2" filter="url(#shadowD)"/>
  <text x="250" y="101" text-anchor="middle" font-size="11" font-weight="600" fill="#6a1b9a">Query</text>

  <!-- Arrows to BM25 and Dense -->
  <line x1="224" y1="110" x2="148" y2="132" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>
  <line x1="276" y1="110" x2="352" y2="132" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>

  <!-- BM25 -->
  <rect x="50" y="135" width="170" height="48" rx="6" fill="#fff3e0" stroke="#e65100" stroke-width="1.2" filter="url(#shadowD)"/>
  <text x="135" y="155" text-anchor="middle" font-size="11" font-weight="600" fill="#e65100">BM25 Sparse</text>
  <text x="135" y="172" text-anchor="middle" font-size="9" fill="#888">rank_bm25 | Top-100</text>

  <!-- Dense -->
  <rect x="280" y="135" width="170" height="48" rx="6" fill="#e3f2fd" stroke="#1565c0" stroke-width="1.2" filter="url(#shadowD)"/>
  <text x="365" y="155" text-anchor="middle" font-size="11" font-weight="600" fill="#1565c0">Dense Bi-Encoder</text>
  <text x="365" y="172" text-anchor="middle" font-size="9" fill="#888">all-MiniLM-L6-v2 | Top-100</text>

  <!-- Arrows to RRF -->
  <line x1="135" y1="183" x2="200" y2="208" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>
  <line x1="365" y1="183" x2="300" y2="208" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>

  <!-- RRF -->
  <rect x="150" y="210" width="200" height="42" rx="6" fill="#f3e5f5" stroke="#6a1b9a" stroke-width="1.5" filter="url(#shadowD)"/>
  <text x="250" y="228" text-anchor="middle" font-size="11" font-weight="700" fill="#6a1b9a">RRF Fusion</text>
  <text x="250" y="243" text-anchor="middle" font-size="9" fill="#888">k=60 | Top-100</text>

  <!-- Arrow from RRF to Cross-Encoder -->
  <line x1="250" y1="252" x2="250" y2="300" stroke="#555" stroke-width="1.5" marker-end="url(#arrowD)"/>
  <text x="268" y="280" font-size="9" fill="#888">Top-50</text>

  <!-- Stage 2: Reranking -->
  <rect x="30" y="275" width="440" height="240" rx="10" fill="#fff9f5" stroke="#e65100" stroke-width="1" stroke-dasharray="4"/>
  <text x="45" y="295" font-size="12" font-weight="700" fill="#e65100">Stage 2: Reranking</text>

  <!-- Cross-Encoder -->
  <rect x="65" y="305" width="370" height="52" rx="6" fill="#fff3e0" stroke="#e65100" stroke-width="1.5" filter="url(#shadowD)"/>
  <text x="250" y="326" text-anchor="middle" font-size="12" font-weight="600" fill="#e65100">Cross-Encoder Reranking</text>
  <text x="250" y="344" text-anchor="middle" font-size="10" fill="#888">ms-marco-MiniLM-L-12-v2 | Rerank Top-50</text>

  <!-- Arrow -->
  <line x1="250" y1="357" x2="250" y2="385" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>
  <text x="268" y="376" font-size="9" fill="#888">Top-10</text>

  <!-- LLM Reranker -->
  <rect x="65" y="390" width="370" height="52" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.5" filter="url(#shadowD)"/>
  <text x="250" y="411" text-anchor="middle" font-size="12" font-weight="600" fill="#2e7d32">LLM Listwise Reranker</text>
  <text x="250" y="429" text-anchor="middle" font-size="10" fill="#888">RankGPT-style | Ollama / Claude / Local</text>

  <!-- Arrow to results -->
  <line x1="250" y1="442" x2="250" y2="468" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>

  <!-- Final Results -->
  <rect x="140" y="472" width="220" height="30" rx="15" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.5" filter="url(#shadowD)"/>
  <text x="250" y="492" text-anchor="middle" font-size="12" font-weight="700" fill="#2e7d32">Final Top-10 Results</text>

</svg>
