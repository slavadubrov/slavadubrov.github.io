<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 780 340" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrowD" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <filter id="shadowD" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="390" y="28" text-anchor="middle" font-size="18" font-weight="700" fill="#1a1a2e">Demo Pipeline: search-ranking-stack</text>
  <text x="390" y="48" text-anchor="middle" font-size="12" fill="#666">Amazon ESCI benchmark -- ~500 queries, ~8.5K products</text>

  <!-- Stage 1: Retrieval -->
  <rect x="25" y="70" width="370" height="250" rx="10" fill="#f5f8ff" stroke="#1565c0" stroke-width="1" stroke-dasharray="4"/>
  <text x="40" y="92" font-size="12" font-weight="700" fill="#1565c0">Stage 1: Retrieval</text>

  <!-- Query -->
  <rect x="160" y="102" width="100" height="30" rx="15" fill="#f3e5f5" stroke="#6a1b9a" stroke-width="1.2" filter="url(#shadowD)"/>
  <text x="210" y="122" text-anchor="middle" font-size="11" font-weight="600" fill="#6a1b9a">Query</text>

  <!-- Arrows to BM25 and Dense -->
  <line x1="185" y1="132" x2="115" y2="155" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>
  <line x1="235" y1="132" x2="305" y2="155" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>

  <!-- BM25 -->
  <rect x="45" y="158" width="140" height="50" rx="6" fill="#fff3e0" stroke="#e65100" stroke-width="1.2" filter="url(#shadowD)"/>
  <text x="115" y="179" text-anchor="middle" font-size="11" font-weight="600" fill="#e65100">BM25 Sparse</text>
  <text x="115" y="196" text-anchor="middle" font-size="9" fill="#888">rank_bm25 | Top-100</text>

  <!-- Dense -->
  <rect x="235" y="158" width="140" height="50" rx="6" fill="#e3f2fd" stroke="#1565c0" stroke-width="1.2" filter="url(#shadowD)"/>
  <text x="305" y="179" text-anchor="middle" font-size="11" font-weight="600" fill="#1565c0">Dense Bi-Encoder</text>
  <text x="305" y="196" text-anchor="middle" font-size="9" fill="#888">all-MiniLM-L6-v2 | Top-100</text>

  <!-- Arrows to RRF -->
  <line x1="115" y1="208" x2="175" y2="238" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>
  <line x1="305" y1="208" x2="245" y2="238" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>

  <!-- RRF -->
  <rect x="140" y="240" width="140" height="45" rx="6" fill="#f3e5f5" stroke="#6a1b9a" stroke-width="1.5" filter="url(#shadowD)"/>
  <text x="210" y="259" text-anchor="middle" font-size="11" font-weight="700" fill="#6a1b9a">RRF Fusion</text>
  <text x="210" y="276" text-anchor="middle" font-size="9" fill="#888">k=60 | Top-100</text>

  <!-- Arrow to Stage 2 -->
  <line x1="280" y1="262" x2="410" y2="145" stroke="#555" stroke-width="1.5" marker-end="url(#arrowD)"/>
  <text x="360" y="190" font-size="9" fill="#888" transform="rotate(-35,360,190)">Top-50</text>

  <!-- Stage 2: Reranking -->
  <rect x="400" y="70" width="360" height="250" rx="10" fill="#fff9f5" stroke="#e65100" stroke-width="1" stroke-dasharray="4"/>
  <text x="415" y="92" font-size="12" font-weight="700" fill="#e65100">Stage 2: Reranking</text>

  <!-- Cross-Encoder -->
  <rect x="440" y="108" width="280" height="55" rx="6" fill="#fff3e0" stroke="#e65100" stroke-width="1.5" filter="url(#shadowD)"/>
  <text x="580" y="130" text-anchor="middle" font-size="12" font-weight="600" fill="#e65100">Cross-Encoder Reranking</text>
  <text x="580" y="150" text-anchor="middle" font-size="10" fill="#888">ms-marco-MiniLM-L-12-v2 | Rerank Top-50</text>

  <!-- Arrow -->
  <line x1="580" y1="163" x2="580" y2="190" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>
  <text x="598" y="182" font-size="9" fill="#888">Top-10</text>

  <!-- LLM Reranker -->
  <rect x="440" y="195" width="280" height="55" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.5" filter="url(#shadowD)"/>
  <text x="580" y="217" text-anchor="middle" font-size="12" font-weight="600" fill="#2e7d32">LLM Listwise Reranker</text>
  <text x="580" y="237" text-anchor="middle" font-size="10" fill="#888">RankGPT-style | Ollama / Claude / Local</text>

  <!-- Arrow to results -->
  <line x1="580" y1="250" x2="580" y2="280" stroke="#555" stroke-width="1.2" marker-end="url(#arrowD)"/>

  <!-- Final Results -->
  <rect x="490" y="283" width="180" height="30" rx="15" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.5" filter="url(#shadowD)"/>
  <text x="580" y="303" text-anchor="middle" font-size="12" font-weight="700" fill="#2e7d32">Final Top-10 Results</text>

</svg>
