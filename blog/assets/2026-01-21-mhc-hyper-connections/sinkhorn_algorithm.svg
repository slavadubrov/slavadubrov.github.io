<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 450">
  <defs>
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e0e0e0" stroke-width="0.5"/>
    </pattern>
  </defs>

  <!-- Background with grid -->
  <rect width="900" height="450" fill="#f5f5f5"/>
  <rect width="900" height="450" fill="url(#grid)"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="#1a365d" font-family="system-ui" font-size="24" font-weight="700">Sinkhorn-Knopp Algorithm</text>
  <text x="450" y="58" text-anchor="middle" fill="#64748b" font-family="system-ui" font-size="13">Making doubly stochastic constraints differentiable</text>

  <!-- Step 1: Exponentiate -->
  <rect x="50" y="90" width="160" height="100" rx="4" fill="white" stroke="#1a365d" stroke-width="2"/>
  <text x="130" y="120" text-anchor="middle" fill="#1a365d" font-family="system-ui" font-size="14" font-weight="600">Step 1: Exp</text>
  <text x="130" y="150" text-anchor="middle" fill="#1a365d" font-family="monospace" font-size="13">M = exp(W)</text>
  <text x="130" y="175" text-anchor="middle" fill="#64748b" font-family="system-ui" font-size="11">All elements positive</text>

  <!-- Arrow 1 to 2 -->
  <line x1="210" y1="140" x2="250" y2="140" stroke="#1a365d" stroke-width="2"/>
  <polygon points="255,140 245,135 245,145" fill="#1a365d"/>

  <!-- Step 2: Row Normalize -->
  <rect x="260" y="90" width="160" height="100" rx="4" fill="white" stroke="#1a365d" stroke-width="2"/>
  <text x="340" y="120" text-anchor="middle" fill="#1a365d" font-family="system-ui" font-size="14" font-weight="600">Step 2: Row Norm</text>
  <text x="340" y="150" text-anchor="middle" fill="#1a365d" font-family="monospace" font-size="13">M = M / Σrow</text>
  <text x="340" y="175" text-anchor="middle" fill="#64748b" font-family="system-ui" font-size="11">Each row sums to 1</text>

  <!-- Arrow 2 to 3 -->
  <line x1="420" y1="140" x2="460" y2="140" stroke="#1a365d" stroke-width="2"/>
  <polygon points="465,140 455,135 455,145" fill="#1a365d"/>

  <!-- Step 3: Column Normalize -->
  <rect x="470" y="90" width="160" height="100" rx="4" fill="white" stroke="#1a365d" stroke-width="2"/>
  <text x="550" y="120" text-anchor="middle" fill="#1a365d" font-family="system-ui" font-size="14" font-weight="600">Step 3: Col Norm</text>
  <text x="550" y="150" text-anchor="middle" fill="#1a365d" font-family="monospace" font-size="13">M = M / Σcol</text>
  <text x="550" y="175" text-anchor="middle" fill="#64748b" font-family="system-ui" font-size="11">Each col sums to 1</text>

  <!-- Arrow 3 to Iterate -->
  <line x1="630" y1="140" x2="670" y2="140" stroke="#1a365d" stroke-width="2"/>
  <polygon points="675,140 665,135 665,145" fill="#1a365d"/>

  <!-- Iterate box -->
  <rect x="680" y="90" width="160" height="100" rx="4" fill="white" stroke="#f97316" stroke-width="2"/>
  <text x="760" y="120" text-anchor="middle" fill="#f97316" font-family="system-ui" font-size="14" font-weight="600">Iterate</text>
  <text x="760" y="150" text-anchor="middle" fill="#f97316" font-family="system-ui" font-size="16" font-weight="600">t = 20</text>
  <text x="760" y="175" text-anchor="middle" fill="#64748b" font-family="system-ui" font-size="11">Repeat steps 2-3</text>

  <!-- Loop arrow back -->
  <path d="M 760 195 L 760 230 Q 760 245 740 245 L 360 245 Q 340 245 340 230 L 340 195"
        fill="none" stroke="#f97316" stroke-width="2" stroke-dasharray="6,3"/>
  <polygon points="340,195 335,205 345,205" fill="#f97316"/>

  <!-- Green bracket under all 4 steps (below orange arrow) -->
  <path d="M 50 200 L 50 270 L 440 270 L 450 285 L 460 270 L 850 270 L 850 200"
        fill="none" stroke="#10b981" stroke-width="2"/>

  <!-- Arrow down from bracket to result -->
  <line x1="450" y1="285" x2="450" y2="335" stroke="#10b981" stroke-width="2"/>
  <polygon points="450,340 445,330 455,330" fill="#10b981"/>

  <!-- Result box -->
  <rect x="300" y="345" width="300" height="80" rx="4" fill="white" stroke="#10b981" stroke-width="3"/>
  <text x="450" y="375" text-anchor="middle" fill="#10b981" font-family="system-ui" font-size="16" font-weight="600">Doubly Stochastic Matrix H</text>
  <text x="450" y="405" text-anchor="middle" fill="#64748b" font-family="system-ui" font-size="13">Rows = 1.0 | Columns = 1.0 | All ≥ 0</text>

  <!-- Key insight note -->
  <rect x="640" y="345" width="220" height="80" rx="4" fill="white" stroke="#1a365d" stroke-width="1"/>
  <text x="750" y="373" text-anchor="middle" fill="#1a365d" font-family="system-ui" font-size="12" font-weight="600">Key Insight</text>
  <text x="750" y="395" text-anchor="middle" fill="#64748b" font-family="system-ui" font-size="11">Entire process is</text>
  <text x="750" y="415" text-anchor="middle" fill="#10b981" font-family="system-ui" font-size="12" font-weight="500">differentiable!</text>
</svg>
