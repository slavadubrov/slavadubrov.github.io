<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 900 480" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="activeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#10b981"/>
      <stop offset="100%" stop-color="#059669"/>
    </linearGradient>
    <linearGradient id="routerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#f59e0b"/>
      <stop offset="100%" stop-color="#d97706"/>
    </linearGradient>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#6366f1"/>
    </marker>
    <marker id="arrowActive" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="480" fill="#fafafa"/>

  <!-- Title -->
  <text x="450" y="35" font-family="system-ui, -apple-system, sans-serif" font-size="20" font-weight="600" text-anchor="middle" fill="#1a202c">Mixture of Experts (MoE) Architecture</text>

  <!-- Input -->
  <rect x="390" y="60" width="120" height="40" rx="6" fill="#e0e7ff" stroke="#6366f1" stroke-width="1.5"/>
  <text x="450" y="85" font-family="system-ui, sans-serif" font-size="12" font-weight="600" text-anchor="middle" fill="#3730a3">Input Token</text>

  <!-- Arrow to router -->
  <path d="M 450 100 L 450 130" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

  <!-- Router -->
  <rect x="340" y="140" width="220" height="50" rx="8" fill="url(#routerGrad)"/>
  <text x="450" y="165" font-family="system-ui, sans-serif" font-size="13" font-weight="600" text-anchor="middle" fill="white">Router Network</text>
  <text x="450" y="180" font-family="system-ui, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">Selects top-k experts (k=2)</text>

  <!-- Arrows to experts -->
  <line x1="380" y1="190" x2="130" y2="230" stroke="#d1d5db" stroke-width="1.5" stroke-dasharray="4,2"/>
  <line x1="420" y1="190" x2="295" y2="230" stroke="#d1d5db" stroke-width="1.5" stroke-dasharray="4,2"/>
  <line x1="480" y1="190" x2="605" y2="230" stroke="#10b981" stroke-width="2"/>
  <line x1="520" y1="190" x2="770" y2="230" stroke="#10b981" stroke-width="2"/>

  <!-- Expert 1 (inactive) -->
  <rect x="50" y="240" width="160" height="60" rx="6" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1.5" opacity="0.6"/>
  <text x="130" y="265" font-family="system-ui, sans-serif" font-size="12" font-weight="600" text-anchor="middle" fill="#9ca3af">Expert 1</text>
  <text x="130" y="285" font-family="system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#9ca3af">Language/Grammar</text>

  <!-- Expert 2 (inactive) -->
  <rect x="220" y="240" width="160" height="60" rx="6" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1.5" opacity="0.6"/>
  <text x="300" y="265" font-family="system-ui, sans-serif" font-size="12" font-weight="600" text-anchor="middle" fill="#9ca3af">Expert 2</text>
  <text x="300" y="285" font-family="system-ui, sans-serif" font-size="9" text-anchor="middle" fill="#9ca3af">History/Culture</text>

  <!-- Expert 3 (ACTIVE) -->
  <rect x="520" y="240" width="160" height="60" rx="6" fill="url(#activeGrad)" stroke="#10b981" stroke-width="2"/>
  <text x="600" y="262" font-family="system-ui, sans-serif" font-size="12" font-weight="600" text-anchor="middle" fill="white">Expert 3 ✓</text>
  <text x="600" y="280" font-family="system-ui, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.9)">Science/Physics</text>
  <text x="600" y="295" font-family="system-ui, sans-serif" font-size="8" font-weight="600" text-anchor="middle" fill="white">ACTIVE</text>

  <!-- Expert 4 (ACTIVE) -->
  <rect x="690" y="240" width="160" height="60" rx="6" fill="url(#activeGrad)" stroke="#10b981" stroke-width="2"/>
  <text x="770" y="262" font-family="system-ui, sans-serif" font-size="12" font-weight="600" text-anchor="middle" fill="white">Expert 4 ✓</text>
  <text x="770" y="280" font-family="system-ui, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.9)">Math/Computing</text>
  <text x="770" y="295" font-family="system-ui, sans-serif" font-size="8" font-weight="600" text-anchor="middle" fill="white">ACTIVE</text>

  <!-- Arrows to output -->
  <path d="M 600 300 L 500 340" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#arrowActive)"/>
  <path d="M 770 300 L 500 340" stroke="#10b981" stroke-width="2" fill="none"/>

  <!-- Combined Output -->
  <rect x="390" y="350" width="220" height="50" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
  <text x="500" y="375" font-family="system-ui, sans-serif" font-size="13" font-weight="600" text-anchor="middle" fill="#1e40af">Combined Output</text>
  <text x="500" y="390" font-family="system-ui, sans-serif" font-size="10" text-anchor="middle" fill="#1e40af">Weighted sum of active experts</text>

  <!-- Case Study Box -->
  <rect x="50" y="420" width="800" height="50" rx="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="70" y="442" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#92400e">Mixtral 8x7B:</text>
  <text x="165" y="442" font-family="system-ui, sans-serif" font-size="11" fill="#78350f">Total: 47B params (8 experts)</text>
  <text x="350" y="442" font-family="system-ui, sans-serif" font-size="11" fill="#78350f">•  Active: 13B params (2 experts)</text>
  <text x="550" y="442" font-family="system-ui, sans-serif" font-size="11" fill="#78350f">•  Result: 47B performance at 13B cost</text>
  <text x="765" y="442" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#059669">✓ 3.6× efficiency</text>
</svg>
