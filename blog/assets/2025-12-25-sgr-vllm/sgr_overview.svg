<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <linearGradient id="schemaGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="llmGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#6366f1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4f46e5;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="4" stdDeviation="4" flood-opacity="0.15"/>
    </filter>
    <marker id="arrowPurple" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <path d="M0,0 L12,4 L0,8 L3,4 Z" fill="#8b5cf6"/>
    </marker>
    <marker id="arrowGreen" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <path d="M0,0 L12,4 L0,8 L3,4 Z" fill="#34d399"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="500" fill="#0f172a"/>

  <!-- Title -->
  <text x="450" y="40" font-family="system-ui, -apple-system, sans-serif" font-size="24" font-weight="bold" fill="#f8fafc" text-anchor="middle">Schema-Guided Reasoning (SGR) Overview</text>

  <!-- ==================== LEFT SIDE: INPUTS ==================== -->

  <!-- User Request Box -->
  <g transform="translate(40, 70)">
    <rect x="0" y="0" width="220" height="100" rx="12" fill="url(#inputGrad)" filter="url(#shadow)"/>
    <text x="110" y="28" font-family="system-ui, sans-serif" font-size="14" font-weight="700" fill="white" text-anchor="middle">ðŸ’¬ User Request</text>
    <rect x="12" y="40" width="196" height="48" rx="6" fill="#312e81"/>
    <text x="110" y="62" font-family="monospace" font-size="11" fill="#c7d2fe" text-anchor="middle">"Give me a discount"</text>
    <text x="110" y="78" font-family="system-ui, sans-serif" font-size="10" fill="#a5b4fc" text-anchor="middle">+ context data</text>
  </g>

  <!-- Pydantic Schema Box -->
  <g transform="translate(40, 190)">
    <rect x="0" y="0" width="220" height="180" rx="12" fill="url(#schemaGrad)" filter="url(#shadow)"/>
    <text x="110" y="28" font-family="system-ui, sans-serif" font-size="14" font-weight="700" fill="white" text-anchor="middle">ðŸ“‹ Pydantic Schema</text>

    <rect x="12" y="42" width="196" height="125" rx="6" fill="#064e3b" stroke="#10b981" stroke-width="1"/>
    <text x="20" y="62" font-family="monospace" font-size="9" fill="#a7f3d0">class PricingLogic:</text>
    <text x="20" y="78" font-family="monospace" font-size="9" fill="#6ee7b7">  churn_analysis: str</text>
    <text x="20" y="94" font-family="monospace" font-size="9" fill="#6ee7b7">  financial_analysis: str</text>
    <text x="20" y="110" font-family="monospace" font-size="9" fill="#6ee7b7">  margin_math: str</text>
    <text x="20" y="126" font-family="monospace" font-size="9" fill="#6ee7b7">  max_discount: float</text>
    <text x="20" y="142" font-family="monospace" font-size="9" fill="#6ee7b7">  offer_code: str</text>
    <text x="20" y="158" font-family="monospace" font-size="9" fill="#6ee7b7">  customer_message: str</text>
  </g>

  <!-- ==================== CENTER: vLLM + xgrammar ==================== -->

  <!-- Arrow from User Request to LLM -->
  <path d="M265,120 L320,120 L320,200 L360,200" stroke="#8b5cf6" stroke-width="3" fill="none" stroke-linecap="round" marker-end="url(#arrowPurple)"/>

  <!-- Arrow from Schema to LLM -->
  <path d="M265,280 L320,280 L320,240 L360,240" stroke="#8b5cf6" stroke-width="3" fill="none" stroke-linecap="round" marker-end="url(#arrowPurple)"/>

  <!-- LLM + xgrammar box -->
  <g transform="translate(370, 130)">
    <rect x="0" y="0" width="240" height="170" rx="12" fill="url(#llmGrad)" filter="url(#shadow)"/>
    <text x="120" y="30" font-family="system-ui, sans-serif" font-size="16" font-weight="700" fill="white" text-anchor="middle">ðŸ§  vLLM + xgrammar</text>
    <text x="120" y="52" font-family="system-ui, sans-serif" font-size="12" fill="#fef3c7" text-anchor="middle">Constrained Decoding</text>

    <rect x="15" y="65" width="210" height="90" rx="8" fill="#92400e"/>
    <text x="120" y="88" font-family="system-ui, sans-serif" font-size="11" fill="#fde68a" text-anchor="middle">1. Schema â†’ JSON grammar</text>
    <text x="120" y="108" font-family="system-ui, sans-serif" font-size="11" fill="#fde68a" text-anchor="middle">2. Token-level masking</text>
    <text x="120" y="128" font-family="system-ui, sans-serif" font-size="11" fill="#fde68a" text-anchor="middle">3. Forces valid structure</text>
    <text x="120" y="148" font-family="system-ui, sans-serif" font-size="11" fill="#fde68a" text-anchor="middle">4. Guarantees JSON output</text>
  </g>

  <!-- ==================== RIGHT SIDE: OUTPUT ==================== -->

  <!-- Arrow from LLM to Output -->
  <path d="M615,215 L650,215" stroke="#34d399" stroke-width="3" fill="none" stroke-linecap="round" marker-end="url(#arrowGreen)"/>

  <!-- Structured Output Box -->
  <g transform="translate(660, 100)">
    <rect x="0" y="0" width="220" height="230" rx="12" fill="#1e293b" stroke="#34d399" stroke-width="2" filter="url(#shadow)"/>
    <text x="110" y="28" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#34d399" text-anchor="middle">âœ“ Structured Output</text>

    <rect x="12" y="42" width="196" height="175" rx="8" fill="#0f172a" stroke="#475569" stroke-width="1"/>
    <text x="22" y="62" font-family="monospace" font-size="10" fill="#94a3b8">{</text>
    <text x="22" y="80" font-family="monospace" font-size="10" fill="#6ee7b7">  "churn_analysis":</text>
    <text x="30" y="95" font-family="monospace" font-size="10" fill="#94a3b8">"High value, high risk",</text>
    <text x="22" y="113" font-family="monospace" font-size="10" fill="#6ee7b7">  "margin_math":</text>
    <text x="30" y="128" font-family="monospace" font-size="10" fill="#94a3b8">"$200 * 0.2 = $40",</text>
    <text x="22" y="146" font-family="monospace" font-size="10" fill="#6ee7b7">  "max_discount":</text>
    <text x="30" y="161" font-family="monospace" font-size="10" fill="#fbbf24">15.0,</text>
    <text x="22" y="179" font-family="monospace" font-size="10" fill="#6ee7b7">  "offer_code":</text>
    <text x="30" y="194" font-family="monospace" font-size="10" fill="#94a3b8">"SAVE15"</text>
    <text x="22" y="210" font-family="monospace" font-size="10" fill="#94a3b8">}</text>
  </g>

  <!-- ==================== BOTTOM: KEY INSIGHT ==================== -->
  <g transform="translate(40, 400)">
    <rect x="0" y="0" width="820" height="75" rx="10" fill="#312e81" stroke="#6366f1" stroke-width="2" filter="url(#shadow)"/>
    <text x="410" y="26" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#c7d2fe" text-anchor="middle">ðŸ’¡ Key Insight: Schema acts as a cognitive scaffold â€” it controls reasoning order and prevents skipped steps</text>
    <text x="410" y="52" font-family="system-ui, sans-serif" font-size="12" fill="#a5b4fc" text-anchor="middle">The LLM must fill each field in order, forcing step-by-step analysis before reaching a conclusion</text>
  </g>

  <!-- ==================== FLOW LABELS ==================== -->
  <text x="300" y="155" font-family="system-ui, sans-serif" font-size="10" fill="#8b5cf6" text-anchor="middle">input</text>
  <text x="300" y="315" font-family="system-ui, sans-serif" font-size="10" fill="#8b5cf6" text-anchor="middle">constrains</text>
  <text x="635" y="245" font-family="system-ui, sans-serif" font-size="10" fill="#34d399" text-anchor="middle">produces</text>
</svg>
