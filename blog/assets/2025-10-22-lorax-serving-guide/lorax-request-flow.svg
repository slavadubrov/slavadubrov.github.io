<?xml version='1.0' encoding='utf-8'?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="3" />
      <feOffset dx="2" dy="2" result="offsetblur" />
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.3" />
      </feComponentTransfer>
      <feMerge>
        <feMergeNode />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
  </defs>


  <rect width="100%" height="100%" fill="white" /><g font-family="sans-serif" font-size="14" text-anchor="middle">
    <rect x="50" y="20" width="100" height="40" rx="5" fill="#e0e7ff" stroke="#4f46e5" stroke-width="2" filter="url(#dropShadow)" />
    <text x="100" y="45" fill="#333">Client</text>
    <line x1="100" y1="60" x2="100" y2="480" stroke="#999" stroke-dasharray="5,5" />

    <rect x="250" y="20" width="100" height="40" rx="5" fill="#e0e7ff" stroke="#4f46e5" stroke-width="2" filter="url(#dropShadow)" />
    <text x="300" y="45" fill="#333">Scheduler</text>
    <line x1="300" y1="60" x2="300" y2="480" stroke="#999" stroke-dasharray="5,5" />

    <rect x="450" y="20" width="100" height="40" rx="5" fill="#e0e7ff" stroke="#4f46e5" stroke-width="2" filter="url(#dropShadow)" />
    <text x="500" y="45" fill="#333">Cache</text>
    <line x1="500" y1="60" x2="500" y2="480" stroke="#999" stroke-dasharray="5,5" />

    <rect x="650" y="20" width="100" height="40" rx="5" fill="#fef3c7" stroke="#d97706" stroke-width="2" filter="url(#dropShadow)" />
    <text x="700" y="45" fill="#333">GPU (Base)</text>
    <line x1="700" y1="60" x2="700" y2="480" stroke="#999" stroke-dasharray="5,5" />
  </g>


  <g font-family="sans-serif" font-size="12" fill="#333">

    <line x1="100" y1="90" x2="290" y2="90" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
    <text x="200" y="85" text-anchor="middle">POST /generate (adapter_id: tenant-42)</text>


    <line x1="300" y1="130" x2="490" y2="130" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
    <text x="400" y="125" text-anchor="middle">Check if adapter loaded</text>


    <rect x="420" y="150" width="360" height="100" fill="#f3f4f6" stroke="#ccc" rx="5" />
    <text x="430" y="170" font-weight="bold" fill="#666">Alt: Not in GPU</text>


    <path d="M 500 180 Q 530 180 530 195 Q 530 210 505 210" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" />
    <text x="540" y="200">Load from CPU/Disk</text>


    <line x1="500" y1="230" x2="690" y2="230" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
    <text x="600" y="225" text-anchor="middle">Inject LoRA weights</text>


    <line x1="300" y1="290" x2="690" y2="290" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
    <text x="500" y="285" text-anchor="middle">Batch with other requests</text>


    <path d="M 700 310 Q 730 310 730 325 Q 730 340 705 340" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" />
    <text x="740" y="330">Multi-adapter Forward Pass</text>


    <line x1="700" y1="380" x2="310" y2="380" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" />
    <text x="500" y="375" text-anchor="middle">Stream tokens</text>


    <line x1="300" y1="420" x2="110" y2="420" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" />
    <text x="200" y="415" text-anchor="middle">Streamed response</text>
  </g>
</svg>
